<!-- <header>
   <nav>
     <ul>
      <li><a href="/">Home</a></li>
      <li><a href="about">About</a></li>
      <li><a href="login">Login/Sign Up</a></li>
      <li><a href="/logout">Logout</a></li>
    </ul>
  </nav>
</header> -->

<header>
  <nav>
      <ul>
          <li><a href="#" onclick="navigateTo('/')">Home</a></li>
          <li><a href="#" onclick="navigateTo('about')">About</a></li>
          <li><a href="#" onclick="navigateTo('login')">Login/Sign Up</a></li>
          <li><a href="#" onclick="makeRequestWithJWT()">Protected Resource</a></li>
          <li><a href="#" onclick="logout()">Logout</a></li>
      </ul>
  </nav>
</header>

<script>
  // Utility function to get the JWT token
  function getToken() {
      return localStorage.getItem("jwt");
  }

  // Navigation function for internal links with token handling
  async function navigateTo(routeName) {
      const token = getToken();

      // Define route mapping
      const urlMap = {
          "/": "{{ url_for('home') }}",
          about: "{{ url_for('about') }}",
          login: "{{ url_for('login') }}"
      };

      const routeUrl = urlMap[routeName];
      if (!routeUrl) {
          console.error(`Route '${routeName}' is not defined.`);
          return;
      }

      // Handle login and public routes differently from protected routes
      const isPublicRoute = routeName === "/" || routeName === "about" || routeName === "login";

      try {
          const response = await fetch(routeUrl, {
              method: "GET",
              headers: isPublicRoute
                  ? {}
                  : {
                        Authorization: `Bearer ${token}`,
                    },
          });

          if (response.ok) {
              const pageContent = await response.text();
              document.body.innerHTML = pageContent; // Dynamically update the page content
          } else if (response.status === 401) {
              alert("Session expired or unauthorized. Redirecting to login.");
              localStorage.removeItem("jwt");
              window.location.href = "{{ url_for('login') }}";
          } else {
              console.error("Failed to load the page:", response.statusText);
              alert("An error occurred while loading the page.");
          }
      } catch (error) {
          console.error("Network error:", error);
          alert("A network error occurred. Please try again later.");
      }
  }

  // Logout function
  function logout() {
      localStorage.removeItem("jwt"); // Remove the token
      alert("You have been logged out.");
      window.location.href = "{{ url_for('login') }}"; // Redirect to login page
  }
</script>
